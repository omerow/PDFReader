<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Güvenli PDF Flipbook</title>
    <style>
        :root { --primary: #3498db; --bg: #1a1a1a; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        
        /* Navigasyon Paneli */
        .top-bar {
            height: 60px;
            background: #252525;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            border-bottom: 2px solid var(--primary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn:hover { opacity: 0.8; }

        /* Kitap Alanı */
        #viewer-container {
            width: 100%;
            height: calc(100vh - 62px);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #pdf-render {
            max-width: 90%;
            max-height: 90%;
            box-shadow: 0 0 50px rgba(0,0,0,0.7);
            border: 5px solid #333;
            background: white;
            cursor: pointer;
        }

        .page-info { font-size: 14px; color: #aaa; }
    </style>
</head>
<body>

    <div class="top-bar">
        <input type="file" id="upload" accept="application/pdf" style="display:none">
        <button class="btn" onclick="document.getElementById('upload').click()">PDF SEÇ</button>
        <button class="btn" id="prev">Geri</button>
        <button class="btn" id="next">İleri</button>
        <span class="page-info">Sayfa: <span id="page-num">0</span> / <span id="page-count">0</span></span>
    </div>

    <div id="viewer-container">
        <canvas id="pdf-render"></canvas>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        let pdfDoc = null,
            pageNum = 1,
            pageIsRendering = false,
            pageNumIsPending = null;

        const canvas = document.querySelector('#pdf-render'),
              ctx = canvas.getContext('2d');

        // Sayfayı Çiz
        const renderPage = num => {
            pageIsRendering = true;
            pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale: 1.5 });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderCtx = {
                    canvasContext: ctx,
                    viewport
                };

                page.render(renderCtx).promise.then(() => {
                    pageIsRendering = false;
                    if (pageNumIsPending !== null) {
                        renderPage(pageNumIsPending);
                        pageNumIsPending = null;
                    }
                });

                document.querySelector('#page-num').textContent = num;
            });
        };

        const queueRenderPage = num => {
            if (pageIsRendering) {
                pageNumIsPending = num;
            } else {
                renderPage(num);
            }
        };

        // Navigasyon
        document.querySelector('#prev').addEventListener('click', () => {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        });

        document.querySelector('#next').addEventListener('click', () => {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        });

        // Dosya Yükleme
        document.querySelector('#upload').addEventListener('change', e => {
            const file = e.target.files[0];
            if (file.type !== 'application/pdf') return;

            const reader = new FileReader();
            reader.onload = function() {
                const typedarray = new Uint8Array(this.result);

                pdfjsLib.getDocument(typedarray).promise.then(pdfDoc_ => {
                    pdfDoc = pdfDoc_;
                    document.querySelector('#page-count').textContent = pdfDoc.numPages;
                    renderPage(pageNum);
                });
            };
            reader.readAsArrayBuffer(file);
        });

        // Canvas'a tıklandığında sonraki sayfaya geç (Kitap hissi)
        canvas.addEventListener('click', () => {
            if (pageNum < pdfDoc.numPages) {
                pageNum++;
                queueRenderPage(pageNum);
            }
        });
    </script>
</body>
</html>
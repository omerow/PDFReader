<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hatasız PDF Flipbook</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dflip@1.0.12/css/dflip.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dflip@1.0.12/css/themify-icons.min.css">

    <style>
        body { margin: 0; background-color: #1a1a1a; color: white; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; }
        .nav { padding: 15px; text-align: center; background: #222; border-bottom: 2px solid #3498db; }
        #flipbook-wrapper { flex-grow: 1; width: 100%; height: calc(100vh - 80px); }
        .upload-btn { background: #3498db; color: white; padding: 10px 25px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; }
        #status-msg { margin-top: 5px; font-size: 12px; color: #888; }
    </style>
</head>
<body>

    <div class="nav">
        <input type="file" id="pdf-input" accept="application/pdf" style="display:none;">
        <button class="upload-btn" onclick="document.getElementById('pdf-input').click()">PDF SEÇ VE AÇ</button>
        <div id="status-msg">Kütüphane kontrol ediliyor...</div>
    </div>

    <div id="flipbook-wrapper">
        <div id="df_viewer"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dflip@1.0.12/js/dflip.min.js"></script>

    <script>
        let myFlipbook = null;

        // Kütüphanenin hazır olup olmadığını kontrol eden fonksiyon
        function checkLibraries() {
            if (typeof DFlip !== "undefined") {
                document.getElementById('status-msg').innerText = "Sistem Hazır. Lütfen PDF yükleyin.";
                return true;
            }
            document.getElementById('status-msg').innerText = "Kütüphane yüklenemedi! İnternet bağlantısını veya AdBlock'u kontrol edin.";
            return false;
        }

        $(document).ready(function () {
            // Başlangıçta kontrol et
            setTimeout(checkLibraries, 1000);

            $('#pdf-input').on('change', function (e) {
                if (!checkLibraries()) return;

                const file = e.target.files[0];
                if (!file || file.type !== "application/pdf") return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    const blob = new Blob([event.target.result], { type: 'application/pdf' });
                    const fileURL = URL.createObjectURL(blob);

                    // Eğer zaten bir kitap açıksa temizle
                    if (myFlipbook) {
                        myFlipbook.dispose();
                    }
                    
                    // Önemli: Container'ı sıfırla
                    $('#flipbook-wrapper').html('<div id="df_viewer"></div>');

                    // jQuery eklentisi (.df_book) yerine doğrudan Nesne (new DFlip) oluşturuyoruz
                    // Bu yöntem "is not a function" hatasını tamamen önler
                    myFlipbook = new DFlip("#df_viewer", {
                        source: fileURL,
                        webgl: true,
                        backgroundColor: "#1a1a1a",
                        duration: 800
                    });

                    document.getElementById('status-msg').innerText = "Yüklendi: " + file.name;
                };

                reader.readAsArrayBuffer(file);
            });
        });
    </script>
</body>
</html>